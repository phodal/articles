# 《架构整洁之道》有感

最近，朋友圈都在晒 Uncle Bob 的新书《Clean Architecture》（中文名《架构整洁之道》）的相关内容，书架上也因此新增了一本书。


### 编程的年限

与书本身的架构部分的内容相比，这本书最吸、启发我的地方，怕是**结尾的 《架构设计考古》相关的故事**。编程年限时间越长，经常思考更好的解决方式，能收获到的知识也就越多。如果我们不能决定一个系统的架构，那么就思考、实践如何把它变好。过程中，大抵也是能收获更多的东西，对下一个系统有更多的启发。

不同的年期里，我们对于软件架构的看法是不一样的。过去，我们要面对的是，一行行代码构成的面条式代码，系统处于混沌架构的形式。提取、整理、总结出 MVC 架构之后，应用的架构变得明朗。但是，随着时间的增长，又变成臃肿的单体应用。按业务（领域）拆分出代码，拆分出业务模块，变成一个个的服务。到了今天，我们开始提及演进式架构，以变化的心态，应对软件架构带来的变化。

从某种程度上来说，国外的技术人员到底和国内的技术人员，还是有上那么一些差距。现今，90 年代的程序员，也没能留下多少经验，这一点倒是颇为遗憾的。一来可能是没有记录下来，很多故事只能从内部知道；二来则是不能持续地记录，随着时间的推移，便被潮流覆盖。Robert C·Martin、Martin Fowler、Joel Spolsky、Jeff Atwood 等知名的程序员，写了大量的技术文章。从这点上来，倒是可以和国内的技术氛围形成了对比。

如村上春树在《我的职业是小说家》

### 书评

再回到这本书上，架构也是这样循序渐进出来的。底层的代码，影响了顶层的建筑，。大体上，我是将这本书分成了两部分：

第一、二部分，资深程序的程序员都会有一定的了解、实践。第三部分，是他最为人所知的 SOLID 原则，他最早出现 15 年前的《敏捷软件开发》等书上。而作为一个接受过 ThoughtWorks OO Bootcamp 训练的学员，我大抵还是能相当熟悉的运用它们。

第四部分，在讲述组件化架构，都是能以 UI 项目，而非后端服务谈论组件化架构，那倒能多得几分。终于在第五部分，开始总结性地介绍软件架构？？然后，剩余的部分都在讲代码故事，Uncle Bob 讲述故事的能力，大概是我的好几个数量级。

说到底，还是因为我太年轻了，没能读懂这本书的精髓。看上去像可有可无的大道理，在落地上倒是得自己花时间去考虑。遇到一个架构方面的难题，带上这本书，加上所谓的悟性，或许我的问题就能迎刃而解。这样一来看，本书倒是**不适合初学者**。

## 五个基本原则，让新手写出 “整洁代码”

每个人都有自己对于代码的看法，有自己的偏好。对于我来说，也是如此。作为一个实用主义者，我遵循的东西，比较少，也比较简单。多了，记不住，也不实用。

##  避免预先设计的代码

**架构往往得预先设计的，而代码容易被过度设计**。而事先设计的架构，往往在落地的时候，会遇到一系列的挑战。等到软件交付时，则会变成新的架构，或者该架构的变体。代码，则也是类似的。

日常工作中，我们经常遇到的情况，到底有没有必要提前编写一些代码——这些功能往往是，我们根据以往经验，猜测未来会有的功能？不事先编写，那么后期修改就比较麻烦。事先编写的代码，不符合需求，那么后期还是得重写。只有运气刚刚好，我们才能编写出符合需要的代码。然而，多数时候，我们写的这些代码往往是用不上的。

一旦代码中有大量多余的代码，代码看上去就没那么整洁了。若非要在两者做一个平衡，便是多做一点点，如先把接口准备好，但是不实现相应的功能。

## IDE 重构 vs 手工重构

整洁的代码，意味着**不重复**，而每个人对于重复的定义是不一样的。对于我来说，则是：**事不过三，过三则重构**。耦合和参数，会带来新的复杂度。重构，不是一件容易的事，也不是一件太困难的事。

手工重构代码，意味着风险。如果没有测试，直接对代码进行重构，那么就会生不如死。

IDE 重构代码，则是依赖于 IDE 自带的功能，以通过机器的方式来重构代码。与手工方式相比，它更加的可靠，并且风险相当的低。前提是，该语言有对应的 IDE 可以提供这个功能，如 WebStrom、Intellij IDEA 等。

## 短、平的函数

编写函数的时候，要注意**长度要短**~、**一个函数完成一件事**，并且**避免多级嵌套**。

长的函数，阅读体验不好。多层嵌套的函数，复杂度过高。

采用各种 Lint 来限制函数的长度、层嵌套的数量，是一种颇为有效的降低复杂度的方式。

## 适当的设计模式与原则

设计模式和各种原则是好东西，它们可以方便我们与其他/她开发人员进行交流。当你遇到一个一对多的问题，别人一说，”你这个东西用观察者模式来实现”，那么问题就这么解决了。

设计模式，是一系列对于相关问题的解决方案。缺少编程经验的时候，学习设计模式，是一个不错的提升方式。而问题的关键，在于如何在适当的时候使用它们。在这个过程中，我们经历这么一些情况：

 1. 不知道设计模式
 2. 拿着设计模式的锤子（定律），到处使用
 3. 对设计模式反感，会避免使用
 4. 自然而然的使用设计模式

编程语言在解决问题上是相通的，哪怕是不同范式的设计语言，要解决的问题是一样的，采用的设计模式也就类似。

## 命名而非注释

命名，对于程序员来说，是一个难题。

一个好的变量名、函数名，远远比一行行注释，更重要——代码是写给人看的。

阅读遗留系统代码的时候，最怕的不是又长又深的代码，而是代码中有个 ``42`` 这种魔法数字（magic number），又没有对应的注释。那怕得打出几个电话、发几十条信息，才能知道这该死的 42 到底是什么。

哪怕是使用错误的单词，将 42 赋予这个变量，如 ``var ratio=42``，也远比 42 + 对应的注释拥有更好的可读性。特别是，如果到处是这个 ``42`` 的变量，只会使得到处都是相关的注释。同样的，这个问题，也出现在对于函数的命名上。好在我们对于函数的命名，会略微重视一些。

## 结论

你还有哪些奇技淫巧呢？